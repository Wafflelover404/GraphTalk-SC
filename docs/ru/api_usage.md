# Руководство по использованию API SC-Machine

Этот документ описывает основные конечные точки API SC-Machine для управления базой знаний, извлечения знаний на основе NLP и выполнения запросов.

---

## Конечные точки

### 1. `/query` (POST)
- **Описание:** Запрос к базе знаний с вопросом на естественном языке.
- **Тело запроса:**
  ```json
  { "text": "Я уже 15 лет учу Английский Язык" }
  ```
- **Пример ответа:**
  ```json
  {
    "status": "success",
    "message": "Запрос обработан",
    "response": "Согласно данным, вы учите английский язык уже 15 лет."
  }
  ```
- **Примечания:**
  - Если `humanize=true` передается как параметр запроса, ответ будет сгенерирован LLM с использованием контекста БЗ.

---

### 2. `/upload/kb_nlp_text` (POST)
- **Описание:** Принимает обычный текст (в теле JSON как `{ "text": ... }`), обрабатывает его с помощью LLM для извлечения знаний в формате JSON и загружает в SC-память.
- **Тело запроса:**
  ```json
  { "text": "Я уже 15 лет учу Английский Язык" }
  ```
- **Пример ответа:**
  ```json
  {
    "status": "success",
    "message": "База знаний NLP обработана и загружена из текста",
    "response": {
      "interpreted_json": {
        "Учить": { "Я": "Английский язык" },
        "membership": { "Английский язык": ["15 лет"] },
        "Source content": "Я уже 15 лет учу Английский Язык"
      },
      "llm_raw_json": {
        "Учить": { "Я": "Английский язык" },
        "membership": { "Английский язык": ["15 лет"] },
        "Source content": "Я уже 15 лет учу Английский Язык"
      },
      "load_log": [
        "Узел существует: source_content (из 'Source content') -> ScAddr(262154) | Метка прикреплена",
        "Ссылка исходного содержимого прикреплена: Я уже 15 лет учу Английский Язык",
        "Узел создан: uchit (из 'Учить') -> ScAddr(262406) | Метка прикреплена",
        "Узел создан: ia (из 'Я') -> ScAddr(262410) | Метка прикреплена",
        "Узел создан: angliiskii_iazyk (из 'Английский язык') -> ScAddr(262414) | Метка прикреплена",
        "Отношение создано: Я -[Учить]-> Английский язык",
        "Узел создан: angliiskii_iazyk (из 'Английский язык') -> ScAddr(262420) | Метка прикреплена"
      ]
    }
  }
  ```
- **Примечания:**
  - Конечная точка всегда использует LLM для извлечения знаний и структурирования их в JSON.
  - Поле `load_log` предоставляет пошаговую трассировку того, что было загружено в SC-память.

---

### 3. `/upload/kb_nlp_json` (POST)
- **Описание:** Принимает JSON файл и загружает его непосредственно в SC-память.
- **Запрос:**
  - Загрузите файл `.json` как form-data.
- **Ответ:**
  - То же, что и `/upload/kb_nlp_text`, но без этапа LLM.

---

### 4. `/upload/kb_zip` (POST)
- **Описание:** Загрузить и обработать zip-файл базы знаний (формат SCS).
- **Запрос:**
  - Загрузите файл `.zip` как form-data.
- **Ответ:**
  ```json
  {
    "status": "success",
    "message": "База знаний обработана",
    "response": { "extract_dir": "unpacked_kbs/kb_xxxxx" }
  }
  ```

---

### 5. `/create_token` (POST)
- **Описание:** Сгенерировать новый токен доступа (только один раз).
- **Ответ:**
  ```json
  {
    "status": "success",
    "message": "Токен создан успешно. Сохраните этот токен, так как он не будет показан снова.",
    "token": "..."
  }
  ```

---

## Общие примечания
- Все конечные точки (кроме `/create_token` и `/`) требуют аутентификации с токеном Bearer.
- API разработан для многоязычного, структурированного и объяснимого управления базой знаний.
- Конечные точки NLP предоставляют подробные журналы для прозрачности и отладки.

---

Для получения более подробной информации смотрите основной README или документацию по интерпретации NLP JSON.
