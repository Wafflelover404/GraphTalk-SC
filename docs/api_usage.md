# SC-Machine API Usage Guide

This document describes the main endpoints of the SC-Machine API for knowledge base management, NLP-based knowledge extraction, and querying.

---

## Endpoints

### 1. `/query` (POST)
- **Description:** Query the knowledge base with a natural language question.
- **Request Body:**
  ```json
  { "text": "Я уже 15 лет учу Английский Язык" }
  ```
- **Response Example:**
  ```json
  {
    "status": "success",
    "message": "Query processed",
    "response": "Согласно данным, вы учите английский язык уже 15 лет."
  }
  ```
- **Notes:**
  - If `humanize=true` is passed as a query parameter, the response will be generated by an LLM using the KB context.

---

### 2. `/upload/kb_nlp_text` (POST)
- **Description:** Accepts plain text (in JSON body as `{ "text": ... }`), processes it with an LLM to extract knowledge as JSON, and loads it into SC-memory.
- **Request Body:**
  ```json
  { "text": "Я уже 15 лет учу Английский Язык" }
  ```
- **Response Example:**
  ```json
  {
    "status": "success",
    "message": "NLP knowledge base processed and loaded from text",
    "response": {
      "interpreted_json": {
        "Учить": { "Я": "Английский язык" },
        "membership": { "Английский язык": ["15 лет"] },
        "Source content": "Я уже 15 лет учу Английский Язык"
      },
      "llm_raw_json": {
        "Учить": { "Я": "Английский язык" },
        "membership": { "Английский язык": ["15 лет"] },
        "Source content": "Я уже 15 лет учу Английский Язык"
      },
      "load_log": [
        "Node exists: source_content (from 'Source content') -> ScAddr(262154) | Label attached",
        "Source content link attached: Я уже 15 лет учу Английский Язык",
        "Node created: uchit (from 'Учить') -> ScAddr(262406) | Label attached",
        "Node created: ia (from 'Я') -> ScAddr(262410) | Label attached",
        "Node created: angliiskii_iazyk (from 'Английский язык') -> ScAddr(262414) | Label attached",
        "Relation created: Я -[Учить]-> Английский язык",
        "Node created: angliiskii_iazyk (from 'Английский язык') -> ScAddr(262420) | Label attached"
      ]
    }
  }
  ```
- **Notes:**
  - The endpoint always uses the LLM to extract knowledge and structure it as JSON.
  - The `load_log` field provides a step-by-step trace of what was loaded into SC-memory.

---

### 3. `/upload/kb_nlp_json` (POST)
- **Description:** Accepts a JSON file and loads it directly into SC-memory.
- **Request:**
  - Upload a `.json` file as form-data.
- **Response:**
  - Same as `/upload/kb_nlp_text`, but without the LLM step.

---

### 4. `/upload/kb_zip` (POST)
- **Description:** Upload and process a knowledge base zip file (SCS format).
- **Request:**
  - Upload a `.zip` file as form-data.
- **Response:**
  ```json
  {
    "status": "success",
    "message": "Knowledge base processed",
    "response": { "extract_dir": "unpacked_kbs/kb_xxxxx" }
  }
  ```

---

### 5. `/create_token` (POST)
- **Description:** Generate a new access token (only once).
- **Response:**
  ```json
  {
    "status": "success",
    "message": "Token created successfully. Save this token as it won't be shown again.",
    "token": "..."
  }
  ```

---

## General Notes
- All endpoints (except `/create_token` and `/`) require Bearer token authentication.
- The API is designed for multilingual, structured, and explainable knowledge base management.
- The NLP endpoints provide detailed logs for transparency and debugging.

---

For more details, see the main README or the NLP JSON interpretation documentation.
